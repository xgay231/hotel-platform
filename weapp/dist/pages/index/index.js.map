{"version":3,"file":"pages/index/index.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AAOA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAEA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAIA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAIA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAIA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAIA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAIA;AACA;AACA;AAAA;AACA;AAAA;AAGA;AAIA;AACA;AAAA;AAGA;AAAA;AACA;AAIA;AAAA;AAAA;AAEA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AAEA;;;;;;;;;;;;;;;AC7QA;AACA;AACA;;AAEA;;AAYA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAGA;AACA;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AAAA;AAEA;AAAA;AAAA;AACA;AAIA;AAAA;AAEA;AACA;AASA;AAGA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAGA;AAAA;AAIA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AAGA;AAEA;;;;;;;;;;;;;ACnPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://hotel-platform/._src_pages_index_index.tsx","webpack://hotel-platform/._src_components_Calendar_index.tsx","webpack://hotel-platform/./src/pages/index/index.tsx?743a"],"sourcesContent":["import { View, Image, Swiper, SwiperItem, Input, Text, Button } from '@tarojs/components'\nimport Taro from '@tarojs/taro'\nimport { useState } from 'react'\nimport Calendar from '../../components/Calendar'\nimport './index.scss'\n\n// 定义Banner数据类型\ninterface BannerItem {\n  id: string\n  imageUrl: string\n  hotelId: string\n}\n\nconst HotelQueryPage = () => {\n  // ========== 原有逻辑保持不变 ==========\n  const [bannerList] = useState<BannerItem[]>([\n    {\n      id: 'banner_1',\n      imageUrl: 'https://picsum.photos/750/400?hotel1',\n      hotelId: 'hotel_001'\n    },\n    {\n      id: 'banner_2',\n      imageUrl: 'https://picsum.photos/750/400?hotel2',\n      hotelId: 'hotel_002'\n    }\n  ])\n\n  const handleBannerClick = (hotelId: string) => {\n    Taro.navigateTo({\n      url: `/pages/detail/index?hotelId=${hotelId}`\n    }).catch(() => {\n      Taro.redirectTo({\n        url: `/pages/detail/index?hotelId=${hotelId}`\n      })\n    })\n  }\n\n  const handleImageError = (imageUrl: string) => {\n    console.warn(`Banner图片加载失败：${imageUrl}`)\n  }\n\n  const [province, setProvince] = useState<string>('')\n  const [city, setCity] = useState<string>('')\n  const [hotelName, setHotelName] = useState<string>('')\n\n  const [checkInDate, setCheckInDate] = useState<string>('')\n  const [checkOutDate, setCheckOutDate] = useState<string>('')\n  const [calendarVisible, setCalendarVisible] = useState<boolean>(false)\n\n  const [minPrice, setMinPrice] = useState<string>('')\n  // 星级状态：0=未选，1=1星及以上，2=2星及以上...5=5星\n  const [selectedStarLevel, setSelectedStarLevel] = useState<number>(0) \n  const starLevels = [1, 2, 3, 4, 5]\n\n  const openCalendar = () => {\n    setCalendarVisible(true)\n  }\n\n  const closeCalendar = () => {\n    setCalendarVisible(false)\n  }\n\n  const confirmDate = (startDate: string, endDate: string) => {\n    setCheckInDate(startDate)\n    setCheckOutDate(endDate)\n  }\n\n  const formatDateShow = (date: string) => {\n    if (!date) return '请选择'\n    const [year, month, day] = date.split('-')\n    return `${month}月${day}日`\n  }\n\n  const getNights = () => {\n    if (!checkInDate || !checkOutDate) return ''\n    const start = new Date(checkInDate).setHours(0, 0, 0, 0)\n    const end = new Date(checkOutDate).setHours(0, 0, 0, 0)\n    const nights = Math.floor((end - start) / (1000 * 60 * 60 * 24))\n    return `共${nights}晚`\n  }\n\n  const handleSearch = () => {\n    if (!province) {\n      Taro.showToast({\n        title: '请填写省份',\n        icon: 'none'\n      })\n      return\n    }\n    if (!checkInDate || !checkOutDate) {\n      Taro.showToast({\n        title: '请选择入住和离店日期',\n        icon: 'none'\n      })\n      return\n    }\n\n    const queryParams: Record<string, string> = {\n      province,\n      city,\n      hotelName,\n      checkInDate,\n      checkOutDate\n    }\n\n    if (minPrice) queryParams.minPrice = minPrice\n    // 传递选中的星级等级（如3表示筛选3星及以上）\n    if (selectedStarLevel > 0) queryParams.starLevel = selectedStarLevel.toString()\n\n    const paramStr = new URLSearchParams(queryParams).toString()\n\n    Taro.navigateTo({\n      url: `/pages/list/index?${paramStr}`\n    })\n  }\n\n  return (\n    <View className=\"hotel-query-page\">\n      {/* ========== 原有UI保持不变 ========== */}\n      <Swiper\n        className=\"banner-container\"\n        indicatorDots\n        autoplay\n        circular\n        interval={5000}\n        duration={500}\n      >\n        {bannerList.map((item) => (\n          <SwiperItem key={item.id} className=\"banner-item\">\n            <View\n              className=\"banner-image-wrap\"\n              onClick={() => handleBannerClick(item.hotelId)}\n            >\n              <Image\n                className=\"banner-image\"\n                src={item.imageUrl}\n                mode=\"aspectFill\"\n                lazyLoad\n                onError={() => handleImageError(item.imageUrl)}\n              />\n            </View>\n          </SwiperItem>\n        ))}\n      </Swiper>\n\n      <View className=\"top-tabs\">\n        <Text className=\"tab-item active\">国内</Text>\n        <Text className=\"tab-item\">海外</Text>\n        <Text className=\"tab-item\">钟点房</Text>\n        <Text className=\"tab-item\">民宿</Text>\n      </View>\n\n      <View className=\"query-form\">\n        {/* 省份+城市行 */}\n        <View className=\"form-row\">\n          <View className=\"form-item half-width\">\n            <Text className=\"label\">省份</Text>\n            <Input\n              className=\"input\"\n              placeholder=\"如：上海\"\n              value={province}\n              onInput={(e) => setProvince(e.detail.value)}\n            />\n          </View>\n          <View className=\"form-item half-width\">\n            <Text className=\"label\">城市</Text>\n            <Input\n              className=\"input\"\n              placeholder=\"选填：具体城市\"\n              value={city}\n              onInput={(e) => setCity(e.detail.value)}\n            />\n          </View>\n        </View>\n\n        {/* 酒店名称行 */}\n        <View className=\"form-row\">\n          <View className=\"form-item full-width\">\n            <Text className=\"label\">酒店名称</Text>\n            <Input\n              className=\"input\"\n              placeholder=\"选填：酒店名称/品牌\"\n              value={hotelName}\n              onInput={(e) => setHotelName(e.detail.value)}\n            />\n          </View>\n        </View>\n\n        {/* 日期行 */}\n        <View className=\"form-row date-row\" onClick={openCalendar}>\n          <View className=\"date-item\">\n            <Text className=\"date-label\">入住</Text>\n            <Text className=\"date-value\">\n              {formatDateShow(checkInDate)}\n            </Text>\n          </View>\n          <Text className=\"date-sep\">—</Text>\n          <View className=\"date-item\">\n            <Text className=\"date-label\">离店</Text>\n            <Text className=\"date-value\">\n              {formatDateShow(checkOutDate)}\n            </Text>\n          </View>\n          <Text className=\"date-nights\">\n            {getNights()}\n          </Text>\n        </View>\n\n        {/* 价格行 */}\n        <View className=\"form-row\">\n          <View className=\"form-item full-width\">\n            <Text className=\"label\">最低价格</Text>\n            <Input\n              className=\"input\"\n              placeholder=\"筛选大于等于该价格的酒店\"\n              value={minPrice}\n              onInput={(e) => {\n                const num = e.detail.value.replace(/\\D/g, '')\n                setMinPrice(num)\n              }}\n              type=\"number\"\n            />\n            <Text className=\"price-unit\">元/晚起</Text>\n          </View>\n        </View>\n\n        {/* ========== 核心修改：星级选择器 ========== */}\n        <View className=\"filter-row\">\n          <Text className=\"filter-title\">酒店星级</Text>\n          <View className=\"star-selector\">\n            {starLevels.map((level) => (\n              <Text\n                key={level}\n                // 关键：判断当前星星是否 ≤ 选中的星级等级\n                className={`star-icon ${level <= selectedStarLevel ? 'active' : ''}`}\n                // 点击时设置为当前星级等级\n                onClick={() => setSelectedStarLevel(level)}\n              >\n                ★\n              </Text>\n            ))}\n            {/* 清除按钮 */}\n            <Text\n              className={`reset-star ${selectedStarLevel > 0 ? 'visible' : ''}`}\n              onClick={() => setSelectedStarLevel(0)}\n            >\n              清除\n            </Text>\n          </View>\n        </View>\n\n        {/* 查询按钮 */}\n        <Button className=\"search-btn\" onClick={handleSearch}>\n          查询\n        </Button>\n      </View>\n\n      <Calendar\n        visible={calendarVisible}\n        onClose={closeCalendar}\n        onConfirm={confirmDate}\n        defaultStartDate={checkInDate}\n        defaultEndDate={checkOutDate}\n      />\n    </View>\n  )\n}\n\nexport default HotelQueryPage","import { View, Text } from '@tarojs/components'\r\nimport React, { useState, useEffect, useCallback } from 'react'\r\nimport './index.scss'\r\n\r\n// 定义日期类型\r\ninterface DateItem {\r\n  day: number\r\n  date: string // YYYY-MM-DD\r\n  isCurrentMonth: boolean\r\n  isToday: boolean\r\n  isSelected: boolean\r\n  isInRange: boolean\r\n  isStart: boolean\r\n  isEnd: boolean\r\n}\r\n\r\n// 组件属性\r\ninterface CalendarProps {\r\n  visible: boolean\r\n  onClose: () => void\r\n  onConfirm: (startDate: string, endDate: string) => void\r\n  defaultStartDate?: string\r\n  defaultEndDate?: string\r\n}\r\n\r\n// 工具函数：格式化日期为 YYYY-MM-DD（彻底解决时区问题）\r\nconst formatDate = (date: Date): string => {\r\n  const year = date.getFullYear()\r\n  const month = String(date.getMonth() + 1).padStart(2, '0')\r\n  const day = String(date.getDate()).padStart(2, '0')\r\n  return `${year}-${month}-${day}`\r\n}\r\n\r\nconst Calendar: React.FC<CalendarProps> = ({\r\n  visible,\r\n  onClose,\r\n  onConfirm,\r\n  defaultStartDate,\r\n  defaultEndDate\r\n}) => {\r\n  // 当前年月\r\n  const [currentYear, setCurrentYear] = useState(new Date().getFullYear())\r\n  const [currentMonth, setCurrentMonth] = useState(new Date().getMonth() + 1)\r\n  // 选中的日期（核心：用useState确保状态更新触发重渲染）\r\n  const [startDate, setStartDate] = useState<string>(defaultStartDate || '')\r\n  const [endDate, setEndDate] = useState<string>(defaultEndDate || '')\r\n  // 日历数据\r\n  const [calendarData, setCalendarData] = useState<DateItem[]>([])\r\n\r\n  // 核心：生成日历数据（抽成独立函数，确保可重复调用）\r\n  const generateCalendar = useCallback((year: number, month: number) => {\r\n    const result: DateItem[] = []\r\n    const firstDay = new Date(year, month - 1, 1)\r\n    const lastDay = new Date(year, month, 0)\r\n    const firstDayWeek = firstDay.getDay() === 0 ? 7 : firstDay.getDay()\r\n    const daysInMonth = lastDay.getDate()\r\n    const today = formatDate(new Date())\r\n\r\n    // 补上个月的尾巴\r\n    const prevMonthLastDay = new Date(year, month - 1, 0).getDate()\r\n    for (let i = firstDayWeek - 1; i > 0; i--) {\r\n      const day = prevMonthLastDay - i + 1\r\n      const date = formatDate(new Date(year, month - 2, day))\r\n      result.push({\r\n        day,\r\n        date,\r\n        isCurrentMonth: false,\r\n        isToday: date === today,\r\n        isSelected: false,\r\n        isInRange: false,\r\n        isStart: false,\r\n        isEnd: false\r\n      })\r\n    }\r\n\r\n    // 当月的日期（核心：每次生成都重新计算选中状态）\r\n    for (let i = 1; i <= daysInMonth; i++) {\r\n      const date = formatDate(new Date(year, month - 1, i))\r\n      // 实时判断选中状态（关键：用最新的startDate/endDate）\r\n      const isStart = date === startDate\r\n      const isEnd = date === endDate\r\n      const isSelected = isStart || isEnd\r\n      \r\n      // 区间判断\r\n      let isInRange = false\r\n      if (startDate && endDate) {\r\n        const start = new Date(startDate).getTime()\r\n        const end = new Date(endDate).getTime()\r\n        const current = new Date(date).getTime()\r\n        isInRange = current > start && current < end\r\n      }\r\n\r\n      result.push({\r\n        day: i,\r\n        date,\r\n        isCurrentMonth: true,\r\n        isToday: date === today,\r\n        isSelected,\r\n        isInRange,\r\n        isStart,\r\n        isEnd\r\n      })\r\n    }\r\n\r\n    // 补下个月的开头\r\n    const totalCells = 42\r\n    const needPad = totalCells - result.length\r\n    for (let i = 1; i <= needPad; i++) {\r\n      const date = formatDate(new Date(year, month, i))\r\n      result.push({\r\n        day: i,\r\n        date,\r\n        isCurrentMonth: false,\r\n        isToday: date === today,\r\n        isSelected: false,\r\n        isInRange: false,\r\n        isStart: false,\r\n        isEnd: false\r\n      })\r\n    }\r\n\r\n    setCalendarData(result)\r\n  }, [startDate, endDate]) // 依赖：startDate/endDate变化就重新生成\r\n\r\n  // 初始化+年月变化+选中日期变化 都重新生成日历\r\n  useEffect(() => {\r\n    generateCalendar(currentYear, currentMonth)\r\n  }, [currentYear, currentMonth, generateCalendar])\r\n\r\n  // 切换月份\r\n  const changeMonth = (type: 'prev' | 'next') => {\r\n    if (type === 'prev') {\r\n      currentMonth === 1 \r\n        ? (setCurrentYear(currentYear - 1), setCurrentMonth(12))\r\n        : setCurrentMonth(currentMonth - 1)\r\n    } else {\r\n      currentMonth === 12 \r\n        ? (setCurrentYear(currentYear + 1), setCurrentMonth(1))\r\n        : setCurrentMonth(currentMonth + 1)\r\n    }\r\n  }\r\n\r\n  // 核心修复：选择日期（即时更新状态+重新生成日历）\r\n  const selectDate = (date: string) => {\r\n    // 过滤非当月/过去的日期\r\n    const targetItem = calendarData.find(item => item.date === date)\r\n    if (!targetItem?.isCurrentMonth) return\r\n    \r\n    const today = formatDate(new Date())\r\n    if (date < today) return\r\n\r\n    // 选择逻辑（即时更新状态）\r\n    if (!startDate) {\r\n      // 第一次选择：设置入住日期\r\n      setStartDate(date)\r\n    } else if (!endDate) {\r\n      // 第二次选择：设置离店日期（必须晚于入住）\r\n      const start = new Date(startDate).getTime()\r\n      const current = new Date(date).getTime()\r\n      if (current > start) {\r\n        setEndDate(date)\r\n      }\r\n    } else {\r\n      // 重新选择：清空离店，重置入住\r\n      setStartDate(date)\r\n      setEndDate('')\r\n    }\r\n\r\n    // 强制触发日历重新生成（确保样式即时更新）\r\n    generateCalendar(currentYear, currentMonth)\r\n  }\r\n\r\n  // 确认选择\r\n  const handleConfirm = () => {\r\n    if (startDate && endDate) {\r\n      onConfirm(startDate, endDate)\r\n      onClose()\r\n    }\r\n  }\r\n\r\n  if (!visible) return null\r\n\r\n  return (\r\n    <View className=\"calendar-mask\">\r\n      <View className=\"calendar-container\">\r\n        {/* 日历头部 */}\r\n        <View className=\"calendar-header\">\r\n          <Text className=\"header-title\">{currentYear}年{currentMonth}月</Text>\r\n          <View className=\"header-actions\">\r\n            <Text className=\"action-btn\" onClick={() => changeMonth('prev')}>上月</Text>\r\n            <Text className=\"action-btn\" onClick={() => changeMonth('next')}>下月</Text>\r\n          </View>\r\n        </View>\r\n\r\n        {/* 星期标题 */}\r\n        <View className=\"calendar-week\">\r\n          {['一', '二', '三', '四', '五', '六', '日'].map((item) => (\r\n            <Text key={item} className=\"week-item\">{item}</Text>\r\n          ))}\r\n        </View>\r\n\r\n        {/* 日历主体（确保样式类正确） */}\r\n        <View className=\"calendar-body\">\r\n          {calendarData.map((item, index) => {\r\n            const baseClass = 'calendar-item'\r\n            const modifiers = [\r\n              item.isCurrentMonth ? '' : 'not-current',\r\n              item.isToday ? 'today' : '',\r\n              item.isSelected ? 'selected' : '',\r\n              item.isInRange ? 'in-range' : '',\r\n              item.isStart ? 'start' : '',\r\n              item.isEnd ? 'end' : ''\r\n            ].filter(Boolean).join(' ')\r\n\r\n            return (\r\n              <View\r\n                key={index}\r\n                className={`${baseClass} ${modifiers}`}\r\n                onClick={() => selectDate(item.date)}\r\n                // 增加点击反馈（可选）\r\n                hoverClass=\"calendar-item-hover\"\r\n              >\r\n                <Text className=\"day-text\">{item.day}</Text>\r\n              </View>\r\n            )\r\n          })}\r\n        </View>\r\n\r\n        {/* 底部操作栏 */}\r\n        <View className=\"calendar-footer\">\r\n          <Text className=\"cancel-btn\" onClick={onClose}>取消</Text>\r\n          <Text \r\n            className={`confirm-btn ${!startDate || !endDate ? 'disabled' : ''}`}\r\n            onClick={handleConfirm}\r\n          >\r\n            确认\r\n          </Text>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  )\r\n}\r\n\r\nexport default Calendar","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/index/index!./index.tsx\"\nvar config = {\"navigationBarTitleText\":\"首页\"};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/index/index', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n"],"names":[],"sourceRoot":""}